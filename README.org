#+TITLE: coldnew's emacs
#+AUTHOR: Yen-Chin, Lee <coldnew>
#+email: coldnew.tw at gmail.com
#+DESCRIPTION: Emacs configuration using early-init.el and init.el with outshine headings
#+LANGUAGE: en
#+STARTUP: overview indent align
#+OPTIONS: ^:nil num:nil tags:nil

#+LINK: emacs     https://www.gnu.org/s/emacs

[[https://img.shields.io/badge/license-WTFPL-yellow.svg?dummy]]

This is my Emacs configuration using direct Emacs Lisp files (~early-init.el~ and ~init.el~) with [[https://github.com/alphapapa/outshine][outshine]] headings for navigation.

** File Structure**

- =early-init.el= - Early startup settings (before package initialization)
- =init.el= - Main configuration with outshine headings
- =~/.personal.el= - Local personal settings (loaded at end)

** Install or Testing This Config**

1. Clone repository:

   : git clone https://github.com/coldnew/coldnew-emacs.git

2. Initialize submodules (if any):

   #+BEGIN_EXAMPLE
   git submodule update --init --recursive
   #+END_EXAMPLE

3. Start Emacs. If not using =~/.emacs.d=, run:

   : emacs -q -l ~/coldnew-emacs/init.el

** Building / Compiling**

Use the Makefile to compile configuration files:

- =make= or =make all= - Compile all .el files
- =make compile= - Compile .el files
- =make byte-compile= - Force byte-compilation
- =make native-compile= - Force native compilation (Emacs 28+)
- =make clean= - Remove compiled files

** Running Tests**

ERT (Emacs Lisp Regression Testing) is built into Emacs.

- =make test= - Clean and rebuild configuration
- =emacs -batch -l ert -f ert-run-tests-batch-and-exit= - Run all ERT tests
- =M-x ert= - Run tests interactively in Emacs
- =C-c t= - Run tests for current buffer's test file (if exists)

*** Test Directory Structure

#+BEGIN_EXAMPLE
test/
 ├── my-helpers.el       # Helper utilities for tests
 └── *-test.el          # Test files (pattern: *-test.el)
#+END_EXAMPLE

*** Writing Tests

#+BEGIN_SRC elisp
(ert-deftest my-test-example ()
  "A simple example test."
  (should (= (+ 2 2) 4))
  (should (string-match-p "hello" "hello world")))

;; Test with expected failure
(ert-deftest my-test-failure ()
  :expected-result :failed
  (should nil))
#+END_SRC

*** my/ Prefix Convention

All custom functions use the =my/= prefix for easy identification:

- =my/= - Personal utility functions (=my/cleanup-buffer=, =my/font-exist-p=)
- =my/font-lock-comment-annotations= - Font-lock integration
- =my/llm-get-provider= - LLM provider helpers

Benefits:
- Easy to find all custom functions with =C-h f my/=
- Prevents namespace conflicts with built-in functions
- Consistent naming across configuration

** Navigation with Outshine**

This configuration uses outshine headings instead of org-mode tangling. Navigation:

- =M-x outline-minor-mode= or =M-x outshine-mode= - Enable outline navigation
- =C-c @= - Toggle outline-minor-mode
- =C-c n/p/f/b= - Navigate next/previous/first/last heading

** System Package Requirements**

One-linear install commands for all platforms. Choose your platform and copy-paste.

*** macOS (Homebrew)

#+BEGIN_SRC sh
# One-linear install - all required packages
brew install cmake editorconfig doxygen clang-format pkgconf git rsync make gdb gnuplot plantuml graphviz pandoc ripgrep fd tree-sitter-cli htop tmux less openssh zsh fish pinentry-mac && \
# Emacs options (choose one):
# Option 1: Default Emacs
brew install emacs || \
# Option 2: Emacs Plus (recommended, more features)
brew tap d12frosted/emacs-plus && brew install emacs-plus || \
# Option 3: Emacs Mac (macOS-native)
brew tap railwaycat/homebrew-emacsmacport && brew install emacs-mac || \
# Option 4: Emacs Cask (GUI app)
brew install --cask emacs
#+END_SRC

*Notes*:
- After installing GDB: =codesign -fs $(brew --prefix gdb)= (macOS security)
- For =make=: =echo 'export PATH="$(brew --prefix)/opt/make/libexec/gnubin:$PATH"' >> ~/.zshrc=

*** Gentoo Linux (Portage)

#+BEGIN_SRC sh
# One-linear install - all required packages
emerge dev-build/cmake dev-python/editorconfig app-text/doxygen llvm-core/clang virtual/pkgconfig dev-vcs/git net-misc/rsync dev-build/make dev-debug/gdb sci-visualization/gnuplot media-gfx/plantuml media-gfx/graphviz app-text/pandoc sys-apps/ripgrep sys-apps/fd app-crypt/gnupg app-crypt/pinentry dev-libs/tree-sitter sys-process/htop app-misc/tmux sys-apps/less net-misc/openssh app-shells/zsh app-shells/fish && \
# Emacs with vterm support
echo "app-editors/emacs dynamic-loading gui xwidgets tree-sitter" >> /etc/portage/package.use && emerge app-editors/emacs && emerge app-emacs/vterm
#+END_SRC

*Important USE Flags*:
- =dynamic-loading= - Enables vterm support (required)
- =gui= - Build with GUI
- =xwidgets= - Enable WebKit widgets
- =tree-sitter= - Enable native parsing

*** Debian / Ubuntu (APT)

#+BEGIN_SRC sh
# One-linear install - all required packages
sudo apt install cmake editorconfig doxygen clang-format pkg-config git rsync build-essential gdb gnuplot plantuml graphviz pandoc libtext-multimarkdown-perl ripgrep fd-find tree-sitter-cli htop tmux less openssh-client zsh fish gnupg pinentry-curses && \
# Emacs options (choose one):
# Option 1: Standard Emacs
sudo apt install -y emacs-gtk || \
# Option 2: Lucid GUI
sudo apt install -y emacs-lucid || \
# Option 3: Pure GTK for Wayland
sudo apt install -y emacs-pgtk || \
# Option 4: Terminal only
sudo apt install -y emacs-nox

# vterm compilation support
sudo apt install -y cmake libvterm-dev && \
# Fix fd command name (Ubuntu calls it 'fdfind')
echo 'alias fd=fdfind' >> ~/.bashrc
#+END_SRC

*** Alpine Linux (APK)

#+BEGIN_SRC sh
# One-linear install - all required packages
apk add cmake editorconfig doxygen clang-extra-tools pkgconf git rsync make gdb gnuplot plantuml graphviz pandoc ripgrep fd tree-sitter-cli htop tmux less openssh zsh fish pinentry && \
# Emacs
apk add emacs
#+END_SRC

** Language Servers (LSP)**

Install language servers for advanced IDE features. Choose what you need.

#+BEGIN_SRC sh
# Python (choose one)
pip install ty || \
pip install 'python-lsp-server[all]' || \
pip install basedpyright || \
npm install -g pyright

# JavaScript / TypeScript
npm install -g typescript-language-server

# Rust
rustup component add rust-analyzer

# Go
go install golang.org/x/tools/gopls@latest

# C/C++
# Debian/Ubuntu
sudo apt install -y clangd
# macOS
brew install llvm
# Gentoo
emerge llvm-core/clang
#+END_SRC

** Key Features**

- *Completion Framework*: Vertico + Consult + Marginalia + Orderless
- *Version Control*: Magit with AI-assisted commits (magit-gptcommit)
- *AI Assistants*: Aidermacs (pair programming) + Ellama (general chat)
- *LLM Support*: OpenAI, Anthropic Claude, OpenRouter, OpenCode, Ollama
- *Project Management*: Projectile + projectile-ripgrep
- *Syntax Checking*: Flycheck + Flymake with LSP
- *Tree-sitter*: Native tree-sitter support (Emacs 29+)
- *Notes*: Deft for quick note-taking
- *Org Mode*: Full org setup with agenda and capture templates
- *Vim Emulation*: Evil mode with evil-collection
- *Terminal*: vterm for fast terminal emulation
- *Editorconfig*: Automatic code style configuration
- *Git Integration*: Git-gutter-fringe for visual diff indicators

** License**

WTFPL (Do What The Fuck You Want To Public License) - See [[http://www.wtfpl.net/][http://www.wtfpl.net/]]
